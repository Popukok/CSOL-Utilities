# 命令

## 标识符

控制器在下达命令时，会为每条命令分配一个唯一的标识符 `CmdId`，执行器在取命令时根据 `CmdId` 来区分两条类型相同的指令是否为同一条指令。

## 类型

Lua 执行器支持解释的命令定义在 `Command` 类中，执行器支持解释执行如下命令：

|命令|语义|
|----|----|
|CMD_NOP|不执行任何操作|
|CMD_START_GAME_ROOM|点击“开始游戏”按钮以开始一局新的游戏|
|CMD_CHOOSE_CHARACTER|执行选择角色操作|
|CMD_DEFAULT_IDLE|执行默认挂机动作|
|CMD_EXTENDED_IDLE|执行扩展挂机动作|
|CMD_CONFIRM_RESULTS|执行结算确认操作|
|CMD_CREATE_GAME_ROOM|创建游戏房间|
|CMD_BATCH_COMBINE_PARTS|在制造所批量合成配件|
|CMD_BATCH_PURCHASE_ITEM|在商店内批量兑换指定物品|
|CMD_LOCATE_CURSOR|定位鼠标光标位置|
|CMD_CLEAR_POPUS|尝试清除所有弹窗|

## 时间戳

控制器在下达命令时以 UNIX 时间戳（单位为秒）的形式告知执行器该条命令下达的时刻 `CmdTimepoint`。默认情况下，每条命令都具有 5 秒的有效期，超过该有效期的命令将被忽略。有效期机制可以确保在控制器因诸种因素[^1]无法继续下达命令时，执行器在尽可能短的时间内停止执行，以最大程度减少对系统带来的影响。

[^1]: 在此前对集成工具的稳定性测试结果表明，连续数个星期（甚至数个月）保持计算机开启，并在此期间一直使用集成工具的挂机功能。计算机在长时间开启的情况下，可能存在由其他应用程序导致的内存泄漏（不同计算机内存泄漏情况存在较大差异，与其上运行的软件有关），进而造成系统可用内存空间不足，使控制器无法继续正常运行。

## 重复

`CmdRepeatable` 用于指明在一条命令的有效期内，是否重复执行该条指令。
例如，`CMD_BATCH_COMBINE_PARTS` 用于命令执行器执行合成配件的动作，执行一次配件合成的时间往往很短，若这样的命令只执行一次便停止，则控制器将不得不频繁地为同样的命令申请新的命令标识符（前面提到，`CmdId` 是区分两条指令是否为同一条指令的依据），并将新的命令标识符写入 `$~cmd.lua`，造成额外的性能开销，引入 `CmdRepeatable` 可以解决此问题。